{% load humanize %}
{% load pagination_tags %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <title>thestate.com crime map</title>
        <link rel="stylesheet" href="{{ MEDIA_URL }}css/master.css" type="text/css" media="screen" title="Main CSS File" charset="utf-8" />
        <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAA3fcPN_VWfbAQSbafDHSU8xT7iXR3kLtMxLefJKEKDDHRhmqYtRT7SwwOfOIi1Uw0hsXovAFnaL7nbg"
          type="text/javascript"></script>
        <script type="text/javascript">
  
        //<![CDATA[
        {% block map_script %}

        function load() {
          if (GBrowserIsCompatible()) {
            var map = new GMap2(document.getElementById("map"));
            map.setCenter(new GLatLng(34.002, -81.0239), 10);
            map.addControl(new GSmallMapControl());
          }
          // Adds a Marker
          var tinyIcon = new GIcon();
          tinyIcon.image = "{{ MEDIA_URL }}img/marker_9.png";
          tinyIcon.shadow = "http://labs.google.com/ridefinder/images/mm_20_shadow.png";
          tinyIcon.iconSize = new GSize(12, 20);
          tinyIcon.shadowSize = new GSize(22, 20);
          tinyIcon.iconAnchor = new GPoint(6, 20);
          tinyIcon.infoWindowAnchor = new GPoint(5, 1);
          {% autopaginate object_list 10 %}
          {% for crime in object_list %}
              tinyIcon.image = "{{ MEDIA_URL }}img/marker_{{ crime.crime_type.marker_color }}.png";
              var marker{{ crime.id }} = new GMarker(new GLatLng('{{ crime.latitude }}', '{{ crime.longitude }}'), {title: "{{ crime.crime_type }}", icon:tinyIcon});
              marker{{ crime.id }}.bindInfoWindow("<div class=\"bubble_text\"><h3>{{ crime.block|ordinal }} block of {{ crime.street }}</h3><p>{{ crime.description|truncatewords:50 }}<br /><a href=\"{{ crime.get_absolute_url }}\" style=\"text-align: right;\">Read more</a></p><h5>Added: {{ crime.date }}</h5><h5>Reported as: {{ crime.crime_type }}</h5></div>", {maxWidth: 400});
              map.addOverlay(marker{{ crime.id }});
          {% endfor %}

        }

        {% endblock %}
        //]]>
        </script>
    </head>
    <body onload="load()" onunload="GUnload()">
        <div class="container_12">
            <div id="masthead" class="grid_12">
                <h1 class="logo">thestate.com</h1>
                <div class="ad"></div>
            </div>
  
            <div id="content" class="grid_12">
            <div id="main_content" class="grid_8 alpha">
                <div id="map"></div>
                <div id="crime_list" class="grid_8 alpha">
                    {% block crime_list %}{% endblock %}
                </div><!-- end div#crime_list -->
            </div>
            <div id="sidebar" class="grid_4 omega">
                    <ul id="legend">
                        <li><a href="/crimes/">All Crimes</a></li>

                        <h3>Sort by Crime Type</h3>
                        {% for crimetype in crimetypes %}
                        <li><a href="/crimes/type/{{ crimetype.slug }}"><img src="{{ MEDIA_URL }}img/marker_{{ crimetype.marker_color }}.png" />{{ crimetype }}</a></li>
                        {% endfor %}

                        <h3>Sort by Agency</h3>
                         {% for agency in agencies %}
                        <li><a href="/crimes/agency/{{ agency.slug }}">{{ agency }}</a></li>
                        {% endfor %}

                   </ul><!-- end ul#legend -->
                </div><!-- end div#sidebar -->

                <div class="ad">
                </div><!-- end div.ad -->
            </div><!-- end div#content -->
        </div><!-- end div.container_12 -->
    </body>
</html>

